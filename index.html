<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DELF A1 - Apprentissage & Pr√©paration</title>
    
    <!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –¢–í–û–ô –õ–û–ö–ê–õ–¨–ù–´–ô –§–ê–ô–õ –ë–ò–ë–õ–ò–û–¢–ï–ö–ò -->
    <script src="supabase.js"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-glow: rgba(37, 99, 235, 0.4);
            --accent: #facc15;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --bg: #f8fafc;
            --easing: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; overflow-x: hidden;
        }

        .container {
            width: 100%; max-width: 1280px; padding: 40px 20px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }

        h1 {
            font-size: clamp(3.5rem, 12vw, 6rem);
            font-weight: 800; margin: 0;
            letter-spacing: 0.12em; 
            text-transform: uppercase;
            background: linear-gradient(135deg, #0f172a 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: clamp(1rem, 4vw, 1.4rem);
            color: var(--text-sub);
            margin: 15px 0 40px 0;
            letter-spacing: 0.05em;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –®–ê–ü–ö–ò */
        .scene {
            width: 300px; height: 300px;
            position: relative;
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 40px;
        }

        .hat {
            font-size: 100px; z-index: 10;
            filter: drop-shadow(0 20px 20px rgba(0,0,0,0.15));
            animation: hat-float 4s infinite ease-in-out;
            user-select: none;
            transition: transform 0.5s var(--easing);
        }

        .hat.success-jump {
            animation: none;
            transform: translateY(-100px) scale(1.3) rotate(360deg);
        }

        .sparkle {
            position: absolute; width: 6px; height: 6px;
            background: var(--accent); border-radius: 50%;
            bottom: 0; opacity: 0; z-index: 5;
            animation: rise-up 3s infinite linear;
        }

        @keyframes rise-up {
            0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-350px) translateX(var(--x)) scale(1.8); opacity: 0; }
        }

        @keyframes hat-float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-35px) rotate(5deg) scale(1.05); }
        }

        .cta-stack { display: flex; flex-direction: column; gap: 14px; width: 100%; max-width: 340px; }

        .btn {
            width: 100%; padding: 20px; font-size: 1.1rem; font-weight: 600;
            border-radius: 18px; border: none; cursor: pointer;
            transition: all 0.4s var(--easing);
            display: flex; justify-content: center; align-items: center;
            text-decoration: none;
        }

        .btn-prep { background: var(--primary); color: white; box-shadow: 0 10px 20px -5px var(--primary-glow); }
        .btn-prep:hover { transform: translateY(-6px) scale(1.03); box-shadow: 0 20px 35px -10px var(--primary-glow); }

        .btn-exam { background: white; color: var(--text-main); border: 2px solid #e2e8f0; }
        .btn-exam:hover { border-color: var(--primary); background: #f0f7ff; transform: translateY(-3px) scale(1.01); }

        .btn-reg { 
            background: transparent; color: var(--text-sub); 
            font-size: 0.95rem; margin-top: 10px; font-weight: 500; 
            cursor: pointer; border: none; outline: none;
        }
        .btn-reg:hover { color: var(--primary); text-decoration: underline; }

        /* –û–§–û–†–ú–õ–ï–ù–ò–ï –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–û */
        .modal-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-content {
            background: white; padding: 40px; border-radius: 28px;
            width: 92%; max-width: 420px; position: relative;
            transform: translateY(60px) scale(0.9);
            transition: transform 0.4s var(--easing);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-overlay.active .modal-content { transform: translateY(0) scale(1); }

        .modal-content h2 { 
            font-weight: 800; margin: 0 0 12px 0; 
            font-size: 1.7rem; text-transform: uppercase;
            background: linear-gradient(135deg, #0f172a 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-content p { color: var(--text-sub); margin-bottom: 20px; font-size: 0.95rem; }

        .input-group { margin-bottom: 18px; text-align: left; }
        .input-group input {
            width: 100%; padding: 18px; border-radius: 14px;
            border: 2px solid #f1f5f9; background: #f8fafc;
            font-size: 1rem; font-family: inherit;
            transition: border-color 0.2s ease;
        }

        .input-group input:focus { outline: none; border-color: var(--primary); background: white; }

        .close-btn {
            position: absolute; top: 22px; right: 22px;
            background: none; border: none; font-size: 28px;
            color: var(--text-sub); cursor: pointer;
        }

        /* –ë–õ–û–ö –î–õ–Ø –°–¢–ê–¢–£–°–ù–´–• –°–û–û–ë–©–ï–ù–ò–ô */
        #statusMsg {
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="mainTitle">DELF A1</h1>
        <p class="subtitle">Tests pour se pr√©parer √† l'examen</p>

        <div class="scene">
            <div class="hat" id="mainHat">üéì</div>
            <div class="sparkle" style="--x: -60px; left: 40%; animation-delay: 0s;"></div>
            <div class="sparkle" style="--x: 50px; left: 50%; animation-delay: 0.4s;"></div>
            <div class="sparkle" style="--x: -20px; left: 60%; animation-delay: 0.8s;"></div>
            <div class="sparkle" style="--x: 80px; left: 45%; animation-delay: 1.2s;"></div>
            <div class="sparkle" style="--x: -40px; left: 55%; animation-delay: 1.6s;"></div>
        </div>

        <div class="cta-stack">
            <button class="btn btn-prep" onclick="location.href='#prep'">–ü—Ä–æ–π—Ç–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É</button>
            <button class="btn btn-exam" onclick="location.href='#exam'">–ü—Ä–æ–π—Ç–∏ —ç–∫–∑–∞–º–µ–Ω</button>
            <button class="btn-reg" onclick="window.toggleModal()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è / –í–æ–π—Ç–∏</button>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
    <div class="modal-overlay" id="modalReg">
        <div class="modal-content">
            <button class="close-btn" onclick="window.toggleModal()">&times;</button>
            
            <div id="authBlock">
                <h2 id="authTitle">–í—Ö–æ–¥</h2>
                <p id="authSub">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</p>
                
                <!-- –ö–†–ê–°–ò–í–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –í–ù–£–¢–†–ò -->
                <div id="statusMsg"></div>

                <form onsubmit="window.handleAuth(event)">
                    <div class="input-group"><input type="email" id="login" placeholder="Email" required></div>
                    <div class="input-group"><input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å" required minlength="6"></div>
                    <button type="submit" id="submitBtn" class="btn btn-prep">–í–æ–π—Ç–∏</button>
                </form>
                <div style="margin-top:20px;">
                    <button class="btn-reg" id="switchBtn" onclick="window.toggleAuthMode()">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –°–æ–∑–¥–∞—Ç—å</button><br><br>
                    <button class="btn-reg" onclick="window.showView('reset')">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</button>
                </div>
            </div>

            <!-- –ë–õ–û–ö –°–ë–†–û–°–ê –ü–ê–†–û–õ–Ø -->
            <div id="resetBlock" style="display: none;">
                <h2>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h2>
                <p>–°—Å—ã–ª–∫–∞ –ø—Ä–∏–¥–µ—Ç –Ω–∞ –≤–∞—à Email</p>
                <form onsubmit="window.handleResetPassword(event)">
                    <div class="input-group"><input type="email" id="resetEmail" placeholder="–í–∞—à Email" required></div>
                    <button type="submit" id="resetBtn" class="btn btn-prep">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
                </form>
                <button class="btn-reg" style="display:block; margin: 20px auto 0 auto;" onclick="window.showView('auth')">–ù–∞–∑–∞–¥</button>
            </div>

            <!-- –ë–õ–û–ö –£–°–¢–ê–ù–û–í–ö–ò –ù–û–í–û–ì–û –ü–ê–†–û–õ–Ø -->
            <div id="newPassBlock" style="display: none;">
                <h2>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</h2>
                <p>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</p>
                <form onsubmit="window.handleUpdatePassword(event)">
                    <div class="input-group"><input type="password" id="newPass" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required minlength="6"></div>
                    <button type="submit" id="updateBtn" class="btn btn-prep">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
        const _supabase = window.supabase ? supabase.createClient(
            'https://fceltmajcgvmjtmqmbuh.supabase.co', 
            'sb_publishable_9arN0yQwPf1N8zSh30VjFA_SSUR3P5Q'
        ) : null;

        let isLoginMode = true;

        // –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
        function showStatus(text, isError = false) {
            const status = document.getElementById('statusMsg');
            status.innerText = text;
            status.style.display = 'block';
            status.style.backgroundColor = isError ? '#fee2e2' : '#dcfce7';
            status.style.color = isError ? '#dc2626' : '#16a34a';
        }

        // –û–¢–ö–†–´–¢–ò–ï / –ó–ê–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–ö–ò
        window.toggleModal = function() {
            const modal = document.getElementById('modalReg');
            if (modal) {
                modal.classList.toggle('active');
                // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏/–∑–∞–∫—Ä—ã—Ç–∏–∏
                document.getElementById('statusMsg').style.display = 'none';
            }
        };

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –í–ò–î–ê–ú–ò (–í—Ö–æ–¥ / –°–±—Ä–æ—Å / –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å)
        window.showView = function(viewName) {
            const blocks = { auth: 'authBlock', reset: 'resetBlock', newPass: 'newPassBlock' };
            Object.values(blocks).forEach(id => document.getElementById(id).style.display = 'none');
            document.getElementById(blocks[viewName]).style.display = 'block';
        };

        // –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï "–í–•–û–î" / "–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø"
        window.toggleAuthMode = function() {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').innerText = isLoginMode ? '–í—Ö–æ–¥' : '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
            document.getElementById('submitBtn').innerText = isLoginMode ? '–í–æ–π—Ç–∏' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
            document.getElementById('switchBtn').innerText = isLoginMode ? '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –°–æ–∑–¥–∞—Ç—å' : '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏';
            document.getElementById('statusMsg').style.display = 'none';
        };

        // –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò –ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò (–° –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ 400 –∏ 422)
        window.handleAuth = async function(e) {
            e.preventDefault();
            if (!_supabase) return alert("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞.");

            const btn = document.getElementById('submitBtn');
            const email = document.getElementById('login').value;
            const pass = document.getElementById('pass').value;
            
            btn.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
            btn.disabled = true;

            const { error } = isLoginMode 
                ? await _supabase.auth.signInWithPassword({ email, password: pass })
                : await _supabase.auth.signUp({ email, password: pass });

            if (error) {
                // –ü–ò–®–ï–ú –ö–†–ê–°–ò–í–£–Æ –û–®–ò–ë–ö–£ –í–ù–£–¢–†–ò –ú–û–î–ê–õ–ö–ò
                showStatus(error.message, true);
                console.error("–û—à–∏–±–∫–∞ Supabase:", error);
            } else {
                // –ü–ò–®–ï–ú –£–°–ü–ï–•
                showStatus(isLoginMode ? "–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!" : "–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –ú–æ–∂–Ω–æ –≤—Ö–æ–¥–∏—Ç—å.", false);
                
                // –ü–æ–±–µ–¥–Ω—ã–π –ø—Ä—ã–∂–æ–∫ —à–∞–ø–∫–∏
                const hat = document.getElementById('mainHat');
                if (hat) {
                    hat.classList.add('success-jump');
                    setTimeout(() => hat.classList.remove('success-jump'), 1000);
                }

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞
                setTimeout(() => {
                    window.toggleModal();
                }, 2000);
            }
            btn.innerText = isLoginMode ? "–í–æ–π—Ç–∏" : "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è";
            btn.disabled = false;
        };

        // –õ–û–ì–ò–ö–ê –°–ë–†–û–°–ê –ü–ê–†–û–õ–Ø
        window.handleResetPassword = async function(e) {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value;
            const { error } = await _supabase.auth.resetPasswordForEmail(email, { redirectTo: window.location.href });
            if (error) alert("–û—à–∏–±–∫–∞: " + error.message);
            else { alert("–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!"); window.showView('auth'); }
        };

        // –õ–û–ì–ò–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ü–ê–†–û–õ–Ø
        window.handleUpdatePassword = async function(e) {
            e.preventDefault();
            const pass = document.getElementById('newPass').value;
            const { error } = await _supabase.auth.updateUser({ password: pass });
            if (error) alert("–û—à–∏–±–∫–∞: " + error.message);
            else { alert("–ü–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!"); window.toggleModal(); window.showView('auth'); }
        };

        // –°–û–ë–´–¢–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
        window.addEventListener('load', () => {
            if (window.location.hash.includes('type=recovery')) {
                window.toggleModal();
                window.showView('newPass');
            }
            const m = document.getElementById('modalReg');
            if (m) m.addEventListener('click', (e) => { if (e.target === m) window.toggleModal(); });
        });
    </script>
</body>
</html>
