<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DELF A1 - Apprentissage & Pr√©paration</title>
    
    <!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –õ–û–ö–ê–õ–¨–ù–´–ô –§–ê–ô–õ –ë–ò–ë–õ–ò–û–¢–ï–ö–ò (–ò–ó 4 –ß–ê–°–¢–ï–ô) -->
    <script src="supabase.js"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-glow: rgba(37, 99, 235, 0.4);
            --accent: #facc15;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --bg: #f8fafc;
            --easing: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; overflow-x: hidden;
        }

        .container {
            width: 100%; max-width: 1280px; padding: 40px 20px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }

        h1 {
            font-size: clamp(3rem, 10vw, 5rem);
            font-weight: 800; margin: 0;
            letter-spacing: 0.12em; 
            text-transform: uppercase;
            background: linear-gradient(135deg, #0f172a 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: clamp(1rem, 4vw, 1.4rem);
            color: var(--text-sub);
            margin: 15px 0 40px 0;
            letter-spacing: 0.05em;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –®–ê–ü–ö–ò */
        .scene {
            width: 300px; height: 300px;
            position: relative;
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 40px;
        }

        .hat {
            font-size: 100px; z-index: 10;
            filter: drop-shadow(0 20px 20px rgba(0,0,0,0.15));
            animation: hat-float 4s infinite ease-in-out;
            user-select: none;
            transition: transform 0.5s var(--easing);
        }

        .hat.success-jump {
            animation: none;
            transform: translateY(-100px) scale(1.3) rotate(360deg);
        }

        .sparkle {
            position: absolute; width: 6px; height: 6px;
            background: var(--accent); border-radius: 50%;
            bottom: 0; opacity: 0; z-index: 5;
            animation: rise-up 3s infinite linear;
        }

        @keyframes rise-up {
            0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-350px) translateX(var(--x)) scale(1.8); opacity: 0; }
        }

        @keyframes hat-float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-35px) rotate(5deg) scale(1.05); }
        }

        .cta-stack { display: flex; flex-direction: column; gap: 14px; width: 100%; max-width: 340px; }

        .btn {
            width: 100%; padding: 20px; font-size: 1.1rem; font-weight: 600;
            border-radius: 18px; border: none; cursor: pointer;
            transition: all 0.4s var(--easing);
            display: flex; justify-content: center; align-items: center;
            text-decoration: none;
        }

        .btn-prep { background: var(--primary); color: white; box-shadow: 0 10px 20px -5px var(--primary-glow); }
        .btn-prep:hover { transform: translateY(-6px) scale(1.03); }

        .btn-exam { background: white; color: var(--text-main); border: 2px solid #e2e8f0; }
        .btn-exam:hover { border-color: var(--primary); background: #f0f7ff; }

        /* –°–¢–ò–õ–¨ –î–õ–Ø –ü–†–û–§–ò–õ–Ø –ò –ö–ù–û–ü–û–ö –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò */
        .btn-reg { 
            background: transparent; color: var(--text-sub); 
            font-size: 0.95rem; margin-top: 10px; font-weight: 500; 
            cursor: pointer; border: none; outline: none;
        }
        .btn-reg:hover { color: var(--primary); text-decoration: underline; }

        #userProfile {
            margin-top: 10px; font-size: 1rem; font-weight: 600;
            color: var(--text-main); display: none;
            align-items: center; gap: 10px; justify-content: center;
        }

        .btn-logout { font-size: 0.85rem; color: #ef4444; }

        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: white; padding: 40px; border-radius: 28px;
            width: 92%; max-width: 420px; position: relative; text-align: center;
        }
        .input-group { margin-bottom: 18px; text-align: left; }
        .input-group input { width: 100%; padding: 18px; border-radius: 14px; border: 2px solid #f1f5f9; background: #f8fafc; font-size: 1rem; }
        
        #statusMsg { font-size: 0.9rem; margin-bottom: 15px; padding: 10px; border-radius: 10px; display: none; }
    </style>
</head>
<body>

    <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
    <div class="container" id="mainScreen">
        <h1>DELF A1</h1>
        <p class="subtitle">Tests pour se pr√©parer √† l'examen</p>

        <div class="scene">
            <div class="hat" id="mainHat">üéì</div>
            <div class="sparkle" style="--x: -60px; left: 40%; animation-delay: 0s;"></div>
            <div class="sparkle" style="--x: 50px; left: 50%; animation-delay: 0.4s;"></div>
            <div class="sparkle" style="--x: -20px; left: 60%; animation-delay: 0.8s;"></div>
        </div>

        <div class="cta-stack">
            <button class="btn btn-prep" onclick="showExamList()">–ü—Ä–æ–π—Ç–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É</button>
            <button class="btn btn-exam" onclick="showExamList()">–ü—Ä–æ–π—Ç–∏ —ç–∫–∑–∞–º–µ–Ω</button>
            
            <div id="userProfile">
                <span id="userEmail"></span>
                <button onclick="window.handleLogout()" class="btn-reg btn-logout">(–í—ã–π—Ç–∏)</button>
            </div>
            
            <button id="regBtn" class="btn-reg" onclick="window.toggleModal()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è / –í–æ–π—Ç–∏</button>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù –°–ü–ò–°–ö–ê –¢–ï–°–¢–û–í -->
    <div id="testListScreen" class="container" style="display: none;">
        <h1>Examens DELF A1</h1>
        <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–∞–∫—Ç–∏–∫–∏</p>
        <div class="cta-stack" id="examList">
            <button class="btn btn-exam" onclick="startTest(1)">Test 1: L'invitation ‚úâÔ∏è</button>
            <button class="btn btn-exam" onclick="startTest(2)">Test 2: Au restaurant üçï</button>
            <button class="btn btn-exam" disabled style="opacity: 0.5;">Test 3: La famille (–°–∫–æ—Ä–æ)</button>
        </div>
        <button class="btn-reg" onclick="showMainScreen()" style="margin-top: 30px;">‚¨Ö –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
    </div>

    <!-- –≠–ö–†–ê–ù –¢–ï–°–¢–ê -->
    <div id="testActiveScreen" class="container" style="display: none;">
        <h2 id="testTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</h2>
        <div id="testContent" style="background: white; padding: 30px; border-radius: 24px; margin-bottom: 20px; width: 100%; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);"></div>
        <div id="optionsStack" class="cta-stack"></div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
    <div class="modal-overlay" id="modalReg">
        <div class="modal-content">
            <button class="btn-reg" style="position:absolute; top:20px; right:20px; font-size:24px;" onclick="window.toggleModal()">&times;</button>
            <div id="authBlock">
                <h2 id="authTitle">–í—Ö–æ–¥</h2>
                <div id="statusMsg"></div>
                <form onsubmit="window.handleAuth(event)">
                    <div class="input-group"><input type="email" id="login" placeholder="Email" required></div>
                    <div class="input-group"><input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å" required minlength="6"></div>
                    <button type="submit" id="submitBtn" class="btn btn-prep">–í–æ–π—Ç–∏</button>
                </form>
                <button class="btn-reg" id="switchBtn" onclick="window.toggleAuthMode()">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE ---
        const _supabase = window.supabase ? supabase.createClient(
            'https://fceltmajcgvmjtmqmbuh.supabase.co', 
            'sb_publishable_9arN0yQwPf1N8zSh30VjFA_SSUR3P5Q'
        ) : null;

        let isLoginMode = true;

        // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê (–ü–†–û–§–ò–õ–¨) ---
        function updateUI(user) {
            const regBtn = document.getElementById('regBtn');
            const profile = document.getElementById('userProfile');
            const emailSpan = document.getElementById('userEmail');
            if (user) {
                regBtn.style.display = 'none';
                profile.style.display = 'flex';
                emailSpan.innerText = "Salut, " + user.email.split('@')[0] + "! üëã";
            } else {
                regBtn.style.display = 'block';
                profile.style.display = 'none';
            }
        }

        function showStatus(text, isError = false) {
            const status = document.getElementById('statusMsg');
            status.innerText = text; status.style.display = 'block';
            status.style.backgroundColor = isError ? '#fee2e2' : '#dcfce7';
            status.style.color = isError ? '#dc2626' : '#16a34a';
        }

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –≠–ö–†–ê–ù–ê–ú–ò ---
        window.showExamList = () => {
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('testListScreen').style.display = 'flex';
        };

        window.showMainScreen = () => {
            document.getElementById('testListScreen').style.display = 'none';
            document.getElementById('testActiveScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'flex';
        };

        // --- –õ–û–ì–ò–ö–ê –¢–ï–°–¢–û–í ---
        window.startTest = function(id) {
    document.getElementById('testListScreen').style.display = 'none';
    document.getElementById('testActiveScreen').style.display = 'flex';
    
    const stack = document.getElementById('optionsStack');
    const content = document.getElementById('testContent');
    const title = document.getElementById('testTitle');
    stack.innerHTML = "";

    if (id === 1) {
        title.innerText = "Test 1: L'invitation ‚úâÔ∏è";
        content.innerHTML = `<p><strong>"Salut! Je t'invite pour mon anniversaire samedi √† 19h00. √Ä bient√¥t, Marc."</strong></p><p>Quand est la f√™te ?</p>`;
        renderOptions([
            { t: "A) Vendredi 17h00", c: false },
            { t: "B) Samedi 19h00", c: true },
            { t: "C) Dimanche 10h00", c: false }
        ]);
    } else if (id === 2) {
        title.innerText = "Test 2: Au restaurant üçï";
        content.innerHTML = `<p>Serveur: <strong>"Bonjour ! –í—ã –∂–µ–ª–∞–µ—Ç–µ –∫–æ—Ñ–µ (Vous d√©sirez un caf√©) ?"</strong></p><p>–ß—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç –∫–ª–∏–µ–Ω—Ç?</p>`;
        renderOptions([
            { t: "A) Oui, un caf√© s'il vous pla√Æt", c: true },
            { t: "B) Je m'appelle Marc", c: false },
            { t: "C) J'ai 20 ans", c: false }
        ]);
    }
};

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–Ω–æ–ø–æ–∫
function renderOptions(options) { 
            const stack = document.getElementById('optionsStack');
            stack.innerHTML = "";
            options.forEach(opt => {
                const b = document.createElement('button');
                b.className = "btn btn-exam";
                b.innerText = opt.t;
                b.onclick = () => window.checkAnswer(opt.c);
                stack.appendChild(b);
            });
        };

        window.checkAnswer = function(correct) {
            if(correct) {
                alert("Bravo! üéâ");
                window.saveResult(100);
                window.showMainScreen();
            } else alert("–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑! ‚ùå");
        };

        // --- –°–û–•–†–ê–ù–ï–ù–ò–ï –í –ë–ê–ó–£ ---
       window.saveResult = async function(points) {
    if (!_supabase) {
        console.error("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: _supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!");
        return;
    }

    const { data: { user } } = await _supabase.auth.getUser();
    if (!user) {
        alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç!");
        return;
    }

    const { error } = await _supabase.from('test_results').insert({
        user_id: user.id,
        test_name: 'Test 1',
        score: points,
        max_score: 100
    });

    if (error) console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", error);
    else console.log("‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!");
};

        // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
        window.toggleModal = () => document.getElementById('modalReg').classList.toggle('active');
        window.toggleAuthMode = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').innerText = isLoginMode ? '–í—Ö–æ–¥' : '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
            document.getElementById('submitBtn').innerText = isLoginMode ? '–í–æ–π—Ç–∏' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
        };

        window.handleAuth = async function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
            const email = document.getElementById('login').value;
            const password = document.getElementById('pass').value;

            const { data, error } = isLoginMode 
                ? await _supabase.auth.signInWithPassword({ email, password })
                : await _supabase.auth.signUp({ email, password });

            if (error) showStatus(error.message, true);
            else {
                showStatus("–£—Å–ø–µ—à–Ω–æ!", false);
                setTimeout(() => window.toggleModal(), 1500);
            }
            btn.innerText = isLoginMode ? "–í–æ–π—Ç–∏" : "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è";
        };

        window.handleLogout = async () => { await _supabase.auth.signOut(); };

        // --- –ó–ê–ì–†–£–ó–ö–ê ---
        window.addEventListener('load', async () => {
            if (!_supabase) return;
            const { data: { user } } = await _supabase.auth.getUser();
            updateUI(user);
            _supabase.auth.onAuthStateChange((event, session) => updateUI(session?.user ?? null));
        });
    </script>
</body>
</html>



